<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Post Property | Imo Properties</title>
  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="./post-property.js">
</head>
<body class="post-page">

<header class="header">
  <div class="logo">Imo<span>Properties</span></div>
</header>

<form id="post-property-form" class="property-form">
  <h2>Post Property</h2>
  <input type="text" placeholder="Property Title" id="title" required>
  <input type="text" placeholder="Location" id="location" required>
  <input type="number" placeholder="Price" id="price" required>
  <select id="type">
    <option>Land</option>
    <option>House for Sale</option>
    <option>House for Rent</option>
  </select>
  <textarea placeholder="Property Description" id="description" required></textarea>
  <button type="submit">Post Property</button>
</form>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="js/post-property.js">
    const firebaseConfig = {
        apiKey: "AIzaSyBUH-w7tlIAQuhCgAfsQZm_XXTVIUzYsz8",
        authDomain: "imoproperties.firebaseapp.com",
        projectId: "imoproperties",
        storageBucket: "imoproperties.firebasestorage.app",
        messagingSenderId: "493250223554",
        appId: "1:493250223554:web:53ce9913ec708742e30a5b"
      };
      
    const auth = firebase.auth();
const db = firebase.firestore();

auth.onAuthStateChanged(user=>{
  if(user){
    // check if user plan is still active
    db.collection("agents").doc(user.uid).get().then(doc=>{
      const planEnd = new Date(doc.data().planEndDate);
      const now = new Date();
      if(now>planEnd){
        alert("Your 1-month plan expired. Please contact admin.");
        auth.signOut();
        window.location.href="login.html";
      }
    });
  } else {
    window.location.href="login.html";
  }
});

document.getElementById("post-property-form").addEventListener("submit", e=>{
  e.preventDefault();
  const title = document.getElementById("title").value;
  const location = document.getElementById("location").value;
  const price = document.getElementById("price").value;
  const type = document.getElementById("type").value;
  const description = document.getElementById("description").value;

  const user = auth.currentUser;
  db.collection("properties").add({
    title, location, price, type, description,
    agentID: user.uid,
    postDate: new Date().toISOString()
  }).then(()=>{
    alert("Property posted successfully!");
    document.getElementById("post-property-form").reset();
  }).catch(err=> alert(err.message));
});

</script>

</body>
</html>
